# helm-chart/values.yaml
# Default values for biomed-suite
# This is a YAML-formatted file
# Declare variables to be passed into your templates

# Global settings
global:
  namespace: biomed-suite
  domain: biomed.yourdomain.com
  environment: production

# Docker image configuration
image:
  backend:
    repository: biomed-suite-backend
    tag: v3.0-fixed
    pullPolicy: IfNotPresent
  frontend:
    repository: nginx
    tag: alpine
    pullPolicy: IfNotPresent

# Image pull secrets if using private registry
imagePullSecrets: []

# Backend configuration
backend:
  enabled: true
  replicaCount: 3
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 5000
  
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  env:
    FLASK_ENV: production
    WORKERS: "2"
    THREADS: "4"
    TIMEOUT: "120"
    PORT: "5000"
    PYTHON_VERSION: "3.11.9"
  
  probes:
    liveness:
      enabled: true
      path: /api/health
      initialDelaySeconds: 30
      periodSeconds: 10
    readiness:
      enabled: true
      path: /api/health
      initialDelaySeconds: 10
      periodSeconds: 5
    startup:
      enabled: true
      path: /api/health
      initialDelaySeconds: 0
      periodSeconds: 10

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 2
  
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
  
  tls:
    enabled: true
    secretName: biomed-tls
  
  hosts:
    - host: biomed.yourdomain.com
      paths:
        - path: /api
          pathType: Prefix
          service: backend
        - path: /
          pathType: Prefix
          service: frontend

# Persistent storage
persistence:
  enabled: true
  storageClassName: standard
  accessMode: ReadWriteOnce
  size: 10Gi
  mountPath: /app/data

# Network policies
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress

# Monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
  
  metrics:
    enabled: true
    path: /metrics
    port: 5000

# Security settings
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  capabilities:
    drop:
      - ALL

# Node affinity
nodeSelector: {}

# Pod affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - biomed-suite
          topologyKey: kubernetes.io/hostname

# Tolerations
tolerations: []

# Service Account
serviceAccount:
  create: true
  name: biomed-suite-sa

# RBAC
rbac:
  create: true

# ConfigMaps
configMaps:
  nginxConfig: |
    upstream backend {
        server biomed-backend-service:80;
    }
    server {
        listen 80;
        server_name _;
        
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
        
        location /api {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        location / {
            root /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ /index.html;
        }
    }

# PostgreSQL database (optional)
postgresql:
  enabled: false
  auth:
    database: biomeddb
    username: biomeduser
    password: changeme
  primary:
    persistence:
      enabled: true
      size: 8Gi

# Redis cache (optional)
redis:
  enabled: false
  auth:
    enabled: true
    password: changeme
  master:
    persistence:
      enabled: true
      size: 2Gi
